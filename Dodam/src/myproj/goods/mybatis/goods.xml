<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="goods">
<!-- 상품 처음에 모든리스트 불러오는 부분1 -->
<select id="goodslist" resultType="myproj.goods.dto.GoodsVO">
select g.goods_use, g.stock_name, g.goods_date_in, g.goods_date_out, g.goods_price_in, g.goods_price_out, s.stock_count
from goods g, stock s
where s.stock_name=g.stock_name and goods_num in (select max(goods_num) from goods group by stock_name) and not s.stock_count=0
</select>

<!-- 상품 검색하는 부분 -->
<select id="searchList" parameterType="String" resultType="myproj.goods.dto.GoodsVO">

select g.goods_use, g.stock_name, g.goods_date_in, g.goods_date_out, g.goods_price_in, g.goods_price_out, s.stock_count
from goods g, stock s
where s.stock_name=g.stock_name and goods_num in (select max(goods_num) from goods group by stock_name) and not s.stock_count=0 and s.stock_name like '%'||#{goodsSearch}||'%'

</select>

<!-- 가장 최근의 입고가격불러오는 부분 -->
<select id="priceIn" resultType="String">
	
</select>

<!-- 상품추가할 때 의약품 검색하는 부분 -->
<select id="searchmedi" parameterType="myproj.goods.dto.GoodsVO" resultType="myproj.goods.dto.GoodsVO">
	select *
	from MEDICINE_TOTAL
	where medi_name like '%'||#{medi_name}||'%' and medi_use=#{medi_use}
</select>

<!-- 상품추가버튼 눌렀을 때 상품 등록하는 부분 -->
<insert id="goodsInsert" parameterType="myproj.goods.dto.GoodsVO">
 insert into goods(goods_num, stock_name, goods_date_in,goods_price_in,goods_price_out,
 					goods_count_in,goods_use,goods_inout_type,medi_componentkor,medi_componenteng) 
 values(seq_goods.nextval,#{stock_name},#{goods_date_in},#{goods_price_in},
 		#{goods_price_out},#{goods_count_in},#{goods_use},#{goods_inout_type},#{medi_componentkor},#{medi_componenteng})
</insert>

<!-- 현재 재고에 있는지 없는지 확인하는 부분 -->
<select id="goodsexist" parameterType="myproj.goods.dto.GoodsVO" resultType="int">
   		select count(*) from stock where stock_name=#{stock_name}
</select>
<!-- 상품추가버튼 눌렀을 때 재고에 등록하는 부분 -->
<insert id="stockInsert" parameterType="myproj.goods.dto.GoodsVO">
     INSERT INTO stock VALUES(#{stock_name},#{goods_count_in})
</insert>

<!-- 상품이 있을 경우 카운트 증가하는 부분  -->
<insert id="stockUpdate" parameterType="myproj.goods.dto.GoodsVO">
     update stock set STOCK_COUNT=STOCK_COUNT+#{goods_count_in} where stock_name=#{stock_name}         
</insert>



<!-- 입고내역 불러오는 부분 -->
<!-- 상품 처음에 모든리스트 불러오는 부분 -->
<!-- <select id="historylist" resultType="myproj.goods.dto.GoodsVO"> -->
<!-- 	select * -->
<!-- 	from goods -->
<!-- 	ORDER BY goods_name -->
<!-- </select> -->

</mapper>